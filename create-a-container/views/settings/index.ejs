<%- include('../layouts/header', { 
  title: 'System Settings - MIE',
  breadcrumbs: [
    { label: 'Settings', url: '/settings' }
  ],
  req
}) %>

<div class="card shadow-sm">
  <div class="card-body">
    <h4 class="card-title mb-4">System Settings</h4>

    <form method="POST" action="/settings" aria-label="System settings form">
      <div class="mb-4">
        <h5 class="mb-3">Email Configuration</h5>
        
        <div class="mb-3">
          <label for="smtp_url" class="form-label">
            SMTP URL
          </label>
          <input 
            type="text" 
            class="form-control font-monospace" 
            id="smtp_url" 
            name="smtp_url" 
            value="<%= smtpUrl %>"
            placeholder="smtp://user:pass@smtp.example.com:587"
            aria-describedby="smtp_url_help"
          >
          <div id="smtp_url_help" class="form-text">
            Format: smtp[s]://[[username][:password]@]&lt;host&gt;[:port]
          </div>
        </div>

        <div class="mb-3">
          <label for="smtp_noreply_address" class="form-label">
            No-Reply Email Address
          </label>
          <input 
            type="email" 
            class="form-control" 
            id="smtp_noreply_address" 
            name="smtp_noreply_address" 
            value="<%= smtpNoreplyAddress %>"
            placeholder="noreply@example.com"
            aria-describedby="smtp_noreply_address_help"
          >
          <div id="smtp_noreply_address_help" class="form-text">
            Email address used as "from" address for system emails
          </div>
        </div>
      </div>

      <div class="mb-4">
        <h5 class="mb-3">Push Notification 2FA</h5>
        
        <div class="mb-3">
          <label for="push_notification_url" class="form-label">
            Push Notification URL
          </label>
          <input 
            type="url" 
            class="form-control" 
            id="push_notification_url" 
            name="push_notification_url" 
            value="<%= pushNotificationUrl %>"
            placeholder="https://notification-service.example.com"
            aria-describedby="push_notification_url_help"
          >
          <div id="push_notification_url_help" class="form-text">
            URL of the push notification service endpoint
          </div>
        </div>

        <div class="mb-3">
          <div class="form-check">
            <input 
              class="form-check-input" 
              type="checkbox" 
              id="push_notification_enabled" 
              name="push_notification_enabled"
              <%= pushNotificationEnabled ? 'checked' : '' %>
              aria-describedby="push_notification_enabled_help"
            >
            <label class="form-check-label" for="push_notification_enabled">
              Enable Push Notification 2FA
            </label>
          </div>
          <div id="push_notification_enabled_help" class="form-text">
            When enabled, users must approve login attempts via push notification. URL must be configured.
          </div>
        </div>
      </div>

      <div class="mb-4">
        <h5 class="mb-3">Traefik Configuration</h5>
        
        <div class="mb-3">
          <label for="base_url" class="form-label">
            Base URL
          </label>
          <input 
            type="url" 
            class="form-control" 
            id="base_url" 
            name="base_url" 
            value="<%= baseUrl %>"
            placeholder="http://10.0.0.1:3000"
            aria-describedby="base_url_help"
          >
          <div id="base_url_help" class="form-text">
            Base URL for Traefik HTTP provider to reach this application. If empty, defaults to http://&lt;job-runner-ip&gt;:3000
          </div>
        </div>
      </div>

      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary" aria-label="Save settings">
          Save Settings
        </button>
        <a href="/" class="btn btn-secondary" aria-label="Cancel and return to home">
          Cancel
        </a>
      </div>
    </form>
  </div>
</div>

<%- include('../layouts/footer') %>
