<%- include('../layouts/header', { 
  title: 'Your Containers - MIE',
  breadcrumbs: [
    { label: 'Sites', url: '/sites' },
    { label: site.name, url: `/sites/${site.id}/containers` }
  ],
  colWidth: 'col-12 col-lg-10',
  req
}) %>

<div class="card shadow-sm">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="card-title mb-0">Your Containers - <%= site.name %></h4>
      <a class="btn btn-primary" href="/sites/<%= site.id %>/containers/new" role="button">New Container</a>
    </div>

    <div class="table-responsive">
      <table class="table table-hover table-bordered align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Hostname</th>
            <th>Status</th>
            <th>IPv4</th>
            <th>Template</th>
            <th>Node</th>
            <th>SSH Port</th>
            <th>HTTP Port</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if (rows && rows.length) { %>
            <% rows.forEach(r => { %>
              <tr>
                <td><%= r.hostname %></td>
                <td>
                  <% if (r.status === 'running') { %>
                    <span class="badge bg-success" aria-label="Container is running">Running</span>
                  <% } else if (r.status === 'pending') { %>
                    <span class="badge bg-warning text-dark" aria-label="Container creation pending">
                      <span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
                      Pending
                    </span>
                  <% } else if (r.status === 'creating') { %>
                    <span class="badge bg-info text-dark" aria-label="Container is being created">
                      <span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
                      Creating
                    </span>
                  <% } else if (r.status === 'failed') { %>
                    <span class="badge bg-danger" aria-label="Container creation failed">Failed</span>
                  <% } else if (r.status === 'restarting') { %>
                    <span class="badge bg-info text-dark" aria-label="Container is restarting">
                      <span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
                      Restarting
                    </span>
                  <% } else { %>
                    <span class="badge bg-secondary" aria-label="Container status unknown"><%= r.status || 'Unknown' %></span>
                  <% } %>
                  <% if (r.creationJobId && (r.status === 'pending' || r.status === 'creating' || r.status === 'failed')) { %>
                    <a href="/jobs/<%= r.creationJobId %>" class="btn btn-link btn-sm p-0 ms-1" aria-label="View job details">
                      <i class="bi bi-info-circle"></i> Details
                    </a>
                  <% } %>
                </td>
                <td><%= r.ipv4Address || '-' %></td>
                <td><%= r.template || '-' %></td>
                <td><%= r.nodeName %></td>
                <td><%= r.sshPort || '-' %></td>
                <td><%= r.httpPort || '-' %></td>
                <td>
                  <% if (r.status === 'running' || r.status === 'failed') { %>
                    <a href="/sites/<%= site.id %>/containers/<%= r.id %>/edit" class="btn btn-primary btn-sm" aria-label="Edit services for container <%= r.hostname %>">Edit</a>
                  <% } %>
                  <form method="POST" action="/sites/<%= site.id %>/containers/<%= r.id %>" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete container <%= r.hostname %>? This action cannot be undone.');">
                    <input type="hidden" name="_method" value="DELETE">
                    <button type="submit" class="btn btn-danger btn-sm" aria-label="Delete container <%= r.hostname %>">Delete</button>
                  </form>
                </td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr>
              <td colspan="8" class="text-muted text-center py-4">
                No containers found. Click "New Container" to create your first one.
              </td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
  <div class="card-footer text-muted text-center small">
    &copy; 2025 Medical Informatics Engineering
  </div>
</div>

<%- include('../layouts/footer') %>
