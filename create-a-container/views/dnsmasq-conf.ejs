# standard configuration
no-resolv
no-hosts
dhcp-authoritative
domain-needed
bogus-priv

# internal domain for the site
domain=<%= site.internalDomain %>

# DNS forwarders
<%_ site.dnsForwarders.split(',').forEach((forwarder) => { _%>
server=<%= forwarder.trim() %>
<%_ }) _%>

# DHCP configuration
dhcp-range=<%= site.dhcpRange %>,<%= site.subnetMask %>,12h
dhcp-option=option:router,<%= site.gateway %>

# Address records for nodes
<%_ site.nodes.forEach((node) => { _%>
<%_ if (node.ipv4Address) { _%>
host-record=<%= node.name %>.<%= site.internalDomain %>,<%= node.ipv4Address %>
<%_ } _%>
<%_ }) _%>

# Static DHCP leases for existing containers
<%_ site.nodes.forEach((node) => { _%>
<%_ node.containers.forEach((container) => { _%>
dhcp-host=<%= container.macAddress %>,<%= container.ipv4Address.split('/')[0] %>
host-record=<%= container.hostname %>.<%= site.internalDomain %>,<%= container.ipv4Address.split('/')[0] %>
<%_ }) _%>
<%_ }) _%>

# DNS service records (SRV)
<%_ site.nodes.forEach((node) => { _%>
<%_ node.containers.forEach((container) => { _%>
<%_ if (container.services) { _%>
<%_ container.services.forEach((service) => { _%>
<%_ if (service.type === 'dns' && service.dnsService && service.dnsService.recordType === 'SRV') { _%>
srv-host=<%= service.dnsService.dnsName %>.<%= site.internalDomain %>,<%= container.hostname %>.<%= site.internalDomain %>,<%= service.internalPort %>,0,0
<%_ } _%>
<%_ }) _%>
<%_ } _%>
<%_ }) _%>
<%_ }) _%>
